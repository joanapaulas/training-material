<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Galaxy Training!</title>
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap.min.css?v=3">
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=2">
        <link rel="stylesheet" href="/training-material/assets/css/font-awesome.css">
        <link rel="stylesheet" href="/training-material/assets/css/academicons.css">
        <link rel="stylesheet" href="/training-material/assets/css/syntax_highlighting.css">
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />
    </head>
    <body>
        




<header>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                Galaxy Training!
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/training-material/topics/dev" title="Go back to list of tutorials">
                            <i class="fa fa-folder-o" aria-hidden="true"></i> Development in Galaxy
                        </a>
                    </li>

                    
                        
                        
                        
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Introduction slides">
                                    <i class="fa fa-slideshare" aria-hidden="true"></i> Introduction slides
                                </a>
                                <div class="dropdown-menu">
                                    
                                        
                                            
                                                <a class="dropdown-item" href="/training-material/topics/dev/slides/introduction.html">
                                                    Galaxy from a developer point of view
                                                </a>
                                            
                                        
                                    
                                        
                                            
                                        
                                    
                                        
                                            
                                        
                                    
                                        
                                            
                                        
                                    
                                        
                                            
                                        
                                    
                                        
                                            
                                        
                                    
                                        
                                            
                                        
                                    
                                        
                                            
                                        
                                    
                                        
                                            
                                        
                                    
                                        
                                            
                                        
                                    
                                        
                                            
                                        
                                    
                                        
                                            
                                        
                                    
                                        
                                            
                                        
                                    
                                        
                                            
                                        
                                    
                                        
                                    
                                </div>
                            </li>
                        
                    

                    

                    

                    
                    <li class="nav-item">
                        <a class="nav-link" href="" title="Links to data">
                            <i class="fa fa-files-o" aria-hidden="true"></i> Input Dataset
                        </a>
                    </li>
                    

                    

                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="fa fa-life-ring" aria-hidden="true"></i> Help
    </a>
    <div class="dropdown-menu">
        <a class="dropdown-item" href="https://gitter.im/Galaxy-Training-Network/Lobby" title="Chat on Gitter">
            Gitter
        </a>
        <a class="dropdown-item" href="https://biostar.usegalaxy.org/" title="Ask on Biostars">
            Biostars
        </a>
    </div>
</li>


                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/galaxyproject/training-material/tree/master/topics/dev/tutorials/visualization-charts/tutorial.md">
                            <i class="fa fa-github" aria-hidden="true"></i> Edit
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<div class="container main-content">
    <section class="tutorial">
        <h1>Visualizations: charts plugins</h1>

        <blockquote class="overview">
            <h3>Overview</h3>

            <strong><i class="fa fa-question-circle" aria-hidden="true"></i> Questions</strong>
            <ul>
            
            <li>How can I make a custom plugin for Charts?</li>
            
            </ul>

            <strong><i class="fa fa-bullseye" aria-hidden="true"></i> Objectives</strong>
            <ul>
            
            <li>Learn how to add custom javascript plugins to the Galaxy Charts framework</li>
            
            </ul>

            

            <p><strong><i class="fa fa-hourglass-end" aria-hidden="true"></i> Time estimation:</strong> 1h</p>
        </blockquote>

        <h2 class="no_toc" id="introduction">Introduction</h2>

<p>In this tutorial we are going to demonstrate how to add a 3rd-party visualization to <em>Charts</em> and what the benefits are. The plugin we select for this purpose is the <a href="https://biasmv.github.io/pv/"><em>PV-Javascript Protein Viewer</em></a>. It is an open source, protein structure viewer for <code class="highlighter-rouge">PDB</code>-files. There are many other popular protein structure viewers available for the visualization of <code class="highlighter-rouge">PDB</code>-files such as e.g. <a href="https://arose.github.io/ngl/">NGL</a> (also available in <em>Charts</em>) and <a href="https://chemapps.stolaf.edu/jmol/jsmol/jsmol.htm">JSMol</a>.</p>

<blockquote class="tip">
  <h3 id="-background-what-is-the-pdb-protein-data-bank-file-format"><i class="fa fa-lightbulb-o" aria-hidden="true"></i> Background: What is the PDB (Protein Data Bank) file format?</h3>

  <p>The <code class="highlighter-rouge">PDB</code>-file format contains atomic coordinates of biomolecules derived through a range of experimental and computational methods. Most commonly the file contains a spatial cyrstallographic snapshot of a protein. There are 100s of thousands of protein structures publicly available at the Protein Databank (https://www.rcsb.org). Proteins are usually labeled by a four-letter code.
Here is an example of a <code class="highlighter-rouge">PDB</code>-file for a hydrolase bond to its inhibitor (PDB: <a href="https://www.rcsb.org/pdb/explore/explore.do?structureId=1acb">1ACB</a>):</p>

  <div class="language-bash highlighter-rouge"><pre class="highlight"><code>HEADER    HYDROLASE/HYDROLASE INHIBITOR           08-NOV-91   1ACB              
TITLE     CRYSTAL AND MOLECULAR STRUCTURE OF THE BOVINE ALPHA-CHYMOTRYPSIN-EGLIN
TITLE    2 C COMPLEX AT 2.0 ANGSTROMS RESOLUTION   
...
KEYWDS    SERINE PROTEASE, HYDROLASE-HYDROLASE INHIBITOR COMPLEX                
AUTHOR    R.Z.KRAMER,L.VITAGLIANO,J.BELLA,R.BERISIO,L.MAZZARELLA,
AUTHOR   2 B.BRODSKY,A.ZAGARI,H.M.BERMAN
...
REMARK   1 REFERENCE 1                                                          
REMARK   1  AUTH   M.BOLOGNESI,L.PUGLIESE,G.GATTI,F.FRIGERIO,A.CODA,L.ANTOLINI,
REMARK   1  AUTH 2 H.P.SCHNEBLI,E.MENEGATTI,G.AMICONI,P.ASCENZI                 
REMARK   1  TITL   X-RAY CRYSTAL STRUCTURE OF THE BOVINE                        
REMARK   1  TITL 2 ALPHA-CHYMOTRYPSIN<span class="o">(</span>SLASH<span class="o">)</span>EGLIN C COMPLEX AT 2.6 ANGSTROMS    
...
SEQRES   1 E  245  CYS GLY VAL PRO ALA ILE GLN PRO VAL LEU SER GLY LEU          
SEQRES   2 E  245  SER ARG ILE VAL ASN GLY GLU GLU ALA VAL PRO GLY SER          
SEQRES   3 E  245  TRP PRO TRP GLN VAL SER LEU GLN ASP LYS THR GLY PHE          
...
ATOM      1  N   CYS E   1       2.323 -16.405  18.812  1.00 43.48           N  
ATOM      2  CA  CYS E   1       3.017 -15.136  18.786  1.00 35.11           C  
ATOM      3  C   CYS E   1       4.134 -15.068  19.799  1.00 32.90           C  
ATOM      4  O   CYS E   1       4.173 -15.810  20.772  1.00 41.38           O  
ATOM      5  CB  CYS E   1       2.052 -13.969  19.139  1.00 31.14           C  
ATOM      6  SG  CYS E   1       1.246 -14.085  20.788  1.00 34.72           S  
ATOM      7  N   GLY E   2       4.993 -14.081  19.607  1.00 21.94           N  
...
HETATM 2292  O   HOH E 406      12.343   1.842  12.901  0.86 18.70           O  
HETATM 2293  O   HOH E 407      -4.767  17.237  10.630  1.00 59.78           O  
HETATM 2294  O   HOH E 408      11.489  -6.278  18.740  0.96 20.00           O  
...
</code></pre>
  </div>

  <p>More resources on this file format:</p>

  <ul>
    <li><a href="https://en.wikipedia.org/wiki/Protein_Data_Bank_(file_format)">https://en.wikipedia.org/wiki/Protein_Data_Bank_(file_format) </a></li>
    <li><a href="http://www.wwpdb.org/documentation/file-format">https://www.wwpdb.org/documentation/file-format </a></li>
  </ul>
</blockquote>

<p>As mentioned above we will be focusing on the <em>PV-Javascript Protein Viewer</em> in this tutorial. Now that we have learned about the underlying file format, let us continue by visiting the viewers developer site at <a href="https://biasmv.github.io/pv/">https://biasmv.github.io/pv/ </a> to get familiar with the plugin.</p>

<blockquote class="hands_on">
  <h3 id="-hands-on"><i class="fa fa-pencil" aria-hidden="true"></i> Hands-on</h3>

  <ol>
    <li>
      <p>View the plugin in action, rotate the molecule and change its style.</p>
    </li>
    <li>
      <p>Under which license is this plugin distributed?</p>
    </li>
    <li>
      <p>Can you find the minified code file of this plugin?</p>
    </li>
  </ol>

</blockquote>

<blockquote class="agenda">
  <h3 id="agenda">Agenda</h3>

  <p>In this tutorial, we will deal with:</p>

<ol id="markdown-toc">
  <li><a href="#section-1---basic-plugin-setup" id="markdown-toc-section-1---basic-plugin-setup">Section 1 - Basic plugin setup</a></li>
  <li><a href="#section-2---allow-different-rendering-modes" id="markdown-toc-section-2---allow-different-rendering-modes">Section 2 - Allow different rendering modes</a></li>
  <li><a href="#section-3---adding-more-options" id="markdown-toc-section-3---adding-more-options">Section 3 - Adding more options</a></li>
</ol>

</blockquote>

<h2 id="section-1---basic-plugin-setup">Section 1 - Basic plugin setup</h2>
<h3 id="11-directory-and-plugin-preparations">1.1 Directory and plugin preparations</h3>

<p>In this section we will download the viewer and add it to a local <em>Galaxy</em> instance. All development takes place within the <em>Galaxy</em> codebase. The first thing we are going to do is to clone a <em>Galaxy</em> instance and prepare the directory structure for the new visualization plugin.</p>

<blockquote class="hands_on">
  <h3 id="-hands-on-1"><i class="fa fa-pencil" aria-hidden="true"></i> Hands-on</h3>

  <ol>
    <li>Clone an instance of <em>Galaxy</em> in a path, further referred to as <code class="highlighter-rouge">$GALAXY_ROOT</code>:
      <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>git clone https://github.com/galaxyproject/galaxy
</code></pre>
      </div>
    </li>
    <li>Navigate to the <em>Charts</em> repository root:
      <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">cd</span> <span class="nv">$GALAXY_ROOT</span>/config/plugins/visualizations/charts/static/repository
</code></pre>
      </div>
    </li>
    <li>Register your visualization by adding a new item to <code class="highlighter-rouge">registry.json</code>:
      <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="s2">"myviz"</span> : <span class="o">[</span> <span class="s2">"pdb"</span> <span class="o">]</span>
</code></pre>
      </div>
    </li>
    <li>Create a new directory:
      <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>mkdir -p visualizations/myviz/pdb
<span class="gp">$ </span><span class="nb">cd </span>visualizations/myviz/pdb
</code></pre>
      </div>
    </li>
    <li>Download the minified plugin code for <em>PV-Viewer</em> from <a href="https://github.com/biasmv/pv">Github</a>:
      <div class="language-bash highlighter-rouge"><pre class="highlight"><code>curl https://raw.githubusercontent.com/biasmv/pv/master/bio-pv.min.js -o plugin.js
</code></pre>
      </div>
    </li>
  </ol>
</blockquote>

<p>Now that the directory structure is in place and the 3rd-party code has been made available, we will continue with building our <em>Chart</em> plugin. Each <em>Charts</em> visualization contains <b>3</b> files:</p>

<ul>
  <li>Logo (<code class="highlighter-rouge">logo.png</code>) which will appear in <em>Chart</em>’s plugin selection interface.</li>
  <li>Configuration (<code class="highlighter-rouge">config.js</code>) describing input parameters and options.</li>
  <li>Wrapper (<code class="highlighter-rouge">wrapper.js</code>) which serves as a bridge between <em>Galaxy</em> and our 3rd-party plugin.</li>
</ul>

<p>In the following sections we are going to discuss these files in more detail, create and place them into our plugin directory at <code class="highlighter-rouge">myviz/pdb</code>. Let’s start with the logo for our visualization.</p>

<h3 id="12-your-visualization-needs-a-logo">1.2 Your visualization needs a logo</h3>

<p>Each visualization is represented by a logo in the <em>Charts</em> interface. This makes it easier for users to find and configure their visualization. The logo should be in the <code class="highlighter-rouge">png</code>-file format. It will appear with a width of 120 pixels.</p>

<p>Here’s an example <a href="../../files/charts-plugins/pdb/logo.png">logo</a>:</p>

<p><img src="../../files/charts-plugins/pdb/logo.png" alt="Logo" /></p>

<blockquote class="hands_on">
  <h3 id="-hands-on-2"><i class="fa fa-pencil" aria-hidden="true"></i> Hands-on</h3>

  <ol>
    <li>
      <p>Find an arbitrary image in <code class="highlighter-rouge">PNG</code>-file format. Possibly using <em>Google</em>’s <a href="https://images.google.com">image search</a>.</p>
    </li>
    <li>
      <p>Copy it to the <code class="highlighter-rouge">myviz/pdb</code> directory and name it <code class="highlighter-rouge">logo.png</code>.</p>
    </li>
  </ol>
</blockquote>

<h3 id="13-configure-the-visualization">1.3 Configure the visualization</h3>

<p>Each visualization has a configuration file named <code class="highlighter-rouge">config.js</code>. This file has conceptual similarities with a Tool’s XML-file. It allows developers to specify a variety of attributes and input parameters for their visualization. Throughout this tutorial we are going to gradually augment this file but for now we keep it simple.</p>

<blockquote class="hands_on">
  <h3 id="-hands-on-3"><i class="fa fa-pencil" aria-hidden="true"></i> Hands-on</h3>

  <ol>
    <li>
      <p>Create a file named <code class="highlighter-rouge">config.js</code> with the following content:</p>

      <div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">define</span><span class="p">(</span> <span class="p">[],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">title</span>       <span class="p">:</span> <span class="s1">'A PDB viewer'</span><span class="p">,</span>
        <span class="na">library</span>     <span class="p">:</span> <span class="s1">'My Visualization'</span><span class="p">,</span>
        <span class="na">description</span> <span class="p">:</span> <span class="s1">'Displays Protein Structures.'</span><span class="p">,</span>
        <span class="na">datatypes</span>   <span class="p">:</span> <span class="p">[</span> <span class="s1">'pdb'</span> <span class="p">],</span>
        <span class="na">keywords</span>    <span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>
    </li>
    <li>
      <p>Place it into your plugins directory at <code class="highlighter-rouge">myviz/pdb</code>.</p>
    </li>
  </ol>

</blockquote>

<p>This configures the plugin’s name and a description which will appear on the <em>Charts</em> selection interface. It also links the plugin to the <code class="highlighter-rouge">PDB</code>-file format, which means that for any history item of these file type the plugin will automatically become available. Keywords are optional and can help to improve the annotation.</p>

<h3 id="14-adding-a-wrapper">1.4 Adding a wrapper</h3>

<p>Now we will add a wrapper to connect <em>Charts</em> with the <em>PV-Viewer</em> plugin. The wrapper consists of a <a href="http://backbonejs.org"><em>Backbone</em></a> module written in <em>JavaScript</em>:
 The wrapper receives an <code class="highlighter-rouge">options</code> dictionary with the following <b>four</b> components:</p>
<ul>
  <li><em>charts</em>: The model of the current visualization with attributes, settings etc.</li>
  <li><em>process</em>: A <a href="https://api.jquery.com/jquery.deferred/">jQuery.Deferred()</a> object to allow asynchronous data requests within the wrapper</li>
  <li><em>dataset</em>: Details on the selected datasets such as url, ids etc. which can be used to access the dataset</li>
  <li><em>targets</em>: The DOM ids of the container elements to draw into</li>
</ul>

<blockquote class="hands_on">
  <h3 id="-hands-on-4"><i class="fa fa-pencil" aria-hidden="true"></i> Hands-on</h3>

  <ol>
    <li>Create a file named <code class="highlighter-rouge">wrapper.js</code> which returns a <em>Backbone</em> model:
      <div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">define</span><span class="p">(</span> <span class="p">[</span> <span class="s1">'visualizations/myviz/pdb/plugin'</span> <span class="p">],</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">pv</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="na">initialize</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Add code to configure and execute the plugin here.</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre>
      </div>
    </li>
    <li>Place it into your plugins directory at <code class="highlighter-rouge">myviz/pdb</code>.</li>
  </ol>

</blockquote>

<p>The above wrapper does not do much yet, except requesting the minified plugin code which we downloaded earlier. In order to execute a 3rd-party plugin we need to figure out how it works. This can be done by finding a working example or documentation. Fortunately the <em>PV-Viewer</em> comes with both. Let’s take a look at the <a href="https://pv.readthedocs.io/">documentation</a>.</p>

<blockquote class="hands_on">
  <h3 id="-hands-on-5"><i class="fa fa-pencil" aria-hidden="true"></i> Hands-on</h3>

  <ol>
    <li>
      <p>Identify the parameter which is needed to initialize the plugin when calling <a href="https://pv.readthedocs.io/en/v1.8.1/viewer.html#pv.Viewer"><em>pv.Viewer()</em></a>.</p>
    </li>
    <li>
      <p>Which of the wrapper option components represents this parameter?</p>
    </li>
    <li>
      <p>Can you identify which <code class="highlighter-rouge">mode</code> settings are valid to render the structure with <a href="https://pv.readthedocs.io/en/v1.8.1/viewer.html#pv.Viewer.renderAs"><em>pv.Viewer.renderAs()</em></a>?</p>
    </li>
  </ol>

</blockquote>

<p>Now that we have learned the basics on how the viewer plugin works, we can initialize and load it in <code class="highlighter-rouge">wrapper.js</code>.</p>

<blockquote class="hands_on">
  <h3 id="-hands-on-6"><i class="fa fa-pencil" aria-hidden="true"></i> Hands-on</h3>

  <ol>
    <li>
      <p>Modify <code class="highlighter-rouge">wrapper.js</code> by adding the following code into the <code class="highlighter-rouge">initialize</code> call:</p>

      <div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">viewer</span> <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">Viewer</span><span class="p">(</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span> <span class="nx">options</span><span class="p">.</span><span class="nx">targets</span><span class="p">[</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">),</span> <span class="p">{</span>
    <span class="na">width</span>       <span class="p">:</span> <span class="s1">'auto'</span><span class="p">,</span>
    <span class="na">height</span>      <span class="p">:</span> <span class="s1">'auto'</span><span class="p">,</span>
    <span class="na">antialias</span>   <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">outline</span>     <span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span> <span class="p">{</span>
    <span class="na">url</span>     <span class="p">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">download_url</span><span class="p">,</span>
    <span class="na">success</span> <span class="p">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">response</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">structure</span> <span class="o">=</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">io</span><span class="p">.</span><span class="nx">pdb</span><span class="p">(</span> <span class="nx">response</span> <span class="p">);</span>
        <span class="nx">viewer</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
        <span class="nx">viewer</span><span class="p">.</span><span class="nx">renderAs</span><span class="p">(</span> <span class="s1">'protein'</span><span class="p">,</span> <span class="nx">structure</span><span class="p">,</span> <span class="s1">'cartoon'</span><span class="p">,</span> <span class="p">{}</span> <span class="p">);</span>
        <span class="nx">viewer</span><span class="p">.</span><span class="nx">centerOn</span><span class="p">(</span> <span class="nx">structure</span> <span class="p">);</span>
        <span class="nx">viewer</span><span class="p">.</span><span class="nx">autoZoom</span><span class="p">();</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">process</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre>
      </div>
    </li>
  </ol>
</blockquote>

<h3 id="15-build-the-package">1.5 Build the package</h3>

<p>Now that we have completed the <em>Charts</em> plugin definition, it is time to bundle the scripts and libraries into a single module file using <a href="https://webpack.github.io"><em>webpack</em></a>. Once packed the plugin will be accessible through <em>Galaxy</em>’s user interface. Packing modules does not require restarting your <em>Galaxy</em> instance, just make sure to properly refresh your browser.</p>

<blockquote class="hands_on">
  <h3 id="-hands-on-7"><i class="fa fa-pencil" aria-hidden="true"></i> Hands-on</h3>

  <ol>
    <li>Navigate to <em>Chart</em>’s root directory:
      <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">cd</span> <span class="nv">$GALAXY_ROOT</span>/config/plugins/visualizations/charts
</code></pre>
      </div>
    </li>
    <li>Install the necessary <code class="highlighter-rouge">node-modules</code>, unless already available:
      <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>npm install
</code></pre>
      </div>
    </li>
    <li>Run <code class="highlighter-rouge">webpack</code> to build the plugin:
      <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>webpack

<span class="c"># If webpack is not available on your PATH, use the following command:</span>
<span class="gp">$ </span>node_modules/webpack/bin/webpack.js
</code></pre>
      </div>
    </li>
  </ol>

</blockquote>

<p>Lets test this.</p>

<h3 id="16-test-the-visualization">1.6 Test the visualization</h3>

<p>In this section we will select a <code class="highlighter-rouge">PDB</code>-file from the Protein Databank and visualize it with our new plugin.</p>

<blockquote class="hands_on">
  <h3 id="-hands-on-8"><i class="fa fa-pencil" aria-hidden="true"></i> Hands-on</h3>

  <ol>
    <li>
      <p>Visit <a href="http://www.rcsb.org">https://www.rcsb.org </a> and select a protein structure e.g. <a href="http://www.rcsb.org/pdb/explore/explore.do?structureId=1acb">1ACB</a></p>
    </li>
    <li>
      <p>Copy the link to the raw <code class="highlighter-rouge">PDB</code>-file e.g.</p>

      <div class="language-bash highlighter-rouge"><pre class="highlight"><code>https://files.rcsb.org/view/1ACB.pdb
</code></pre>
      </div>
    </li>
    <li>
      <p>Start your Galaxy instance</p>

      <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">cd</span> <span class="nv">$GALAXY_ROOT</span>
<span class="gp">$ </span>run.sh
</code></pre>
      </div>
    </li>
    <li>
      <p>Open the uploader dialog, paste the above link and click on <em>Start</em>.</p>
    </li>
    <li>
      <p>Close the upload dialog, and select the file from the history panel on the right.</p>
    </li>
    <li>
      <p>Click on the <em>diagram</em> icon. (You must be logged in)</p>
    </li>
    <li>
      <p>Find your visualization and double-click on its logo.</p>
    </li>
  </ol>

</blockquote>

<p><img src="../../images/pv_1.png" alt="First view" /></p>

<h2 id="section-2---allow-different-rendering-modes">Section 2 - Allow different rendering modes</h2>

<p>In this section we are going to augment the visualization such that users may select different rendering modes. This is one of the major advantages of using the <em>Charts</em> framework. Similar to a Tool’s XML file, developers may specify input parameters which then will be presented to the user. The definition of Tool and Visualization input parameters are similar, however the latter is provided in <em>JavaScript</em> and not as XML.
More information on parameters can be found in the <a href="https://docs.galaxyproject.org/en/latest/dev/schema.html">wiki</a>.</p>

<blockquote class="hands_on">
  <h3 id="-hands-on-9"><i class="fa fa-pencil" aria-hidden="true"></i> Hands-on</h3>

  <ol>
    <li>Add the following block into the <code class="highlighter-rouge">config.js</code> file:
      <div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">settings</span> <span class="err">:</span> <span class="p">{</span>
    <span class="nl">mode</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nl">label</span>   <span class="p">:</span> <span class="s1">'Render as:'</span><span class="p">,</span>
        <span class="nx">help</span>    <span class="err">:</span> <span class="s1">'Select the rendering mode.'</span><span class="p">,</span>
        <span class="nx">type</span>    <span class="err">:</span> <span class="s1">'select'</span><span class="p">,</span>
        <span class="nx">display</span> <span class="err">:</span> <span class="s1">'radio'</span><span class="p">,</span>
        <span class="nx">value</span>   <span class="err">:</span> <span class="s1">'cartoon'</span><span class="p">,</span>
        <span class="nx">data</span>    <span class="err">:</span> <span class="p">[</span> <span class="p">{</span> <span class="na">label</span> <span class="p">:</span> <span class="s1">'Cartoon'</span><span class="p">,</span>        <span class="na">value</span> <span class="p">:</span> <span class="s1">'cartoon'</span> <span class="p">},</span>
                    <span class="p">{</span> <span class="na">label</span> <span class="p">:</span> <span class="s1">'Lines'</span><span class="p">,</span>          <span class="na">value</span> <span class="p">:</span> <span class="s1">'lines'</span> <span class="p">},</span>
                    <span class="p">{</span> <span class="na">label</span> <span class="p">:</span> <span class="s1">'Points'</span><span class="p">,</span>         <span class="na">value</span> <span class="p">:</span> <span class="s1">'points'</span> <span class="p">},</span>
                    <span class="p">{</span> <span class="na">label</span> <span class="p">:</span> <span class="s1">'Spheres'</span><span class="p">,</span>        <span class="na">value</span> <span class="p">:</span> <span class="s1">'spheres'</span> <span class="p">},</span>
                    <span class="p">{</span> <span class="na">label</span> <span class="p">:</span> <span class="s1">'Trace'</span><span class="p">,</span>          <span class="na">value</span> <span class="p">:</span> <span class="s1">'trace'</span> <span class="p">},</span>
                    <span class="p">{</span> <span class="na">label</span> <span class="p">:</span> <span class="s1">'Trace (line)'</span><span class="p">,</span>   <span class="na">value</span> <span class="p">:</span> <span class="s1">'lineTrace'</span> <span class="p">},</span>
                    <span class="p">{</span> <span class="na">label</span> <span class="p">:</span> <span class="s1">'Trace (smooth)'</span><span class="p">,</span> <span class="na">value</span> <span class="p">:</span> <span class="s1">'sline'</span> <span class="p">},</span>
                    <span class="p">{</span> <span class="na">label</span> <span class="p">:</span> <span class="s1">'Tube'</span><span class="p">,</span>           <span class="na">value</span> <span class="p">:</span> <span class="s1">'tube'</span> <span class="p">}</span> <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
      </div>
    </li>
    <li>Change the following line in <code class="highlighter-rouge">wrapper.js</code>:
      <div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">viewer</span><span class="p">.</span><span class="nx">renderAs</span><span class="p">(</span> <span class="s1">'protein'</span><span class="p">,</span> <span class="nx">structure</span><span class="p">,</span> <span class="s1">'cartoon'</span><span class="p">,</span> <span class="p">{}</span> <span class="p">);</span>
</code></pre>
      </div>
      <p>to</p>

      <div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">settings</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">chart</span><span class="p">.</span><span class="nx">settings</span><span class="p">;</span>
<span class="nx">viewer</span><span class="p">.</span><span class="nx">renderAs</span><span class="p">(</span> <span class="s1">'protein'</span><span class="p">,</span> <span class="nx">structure</span><span class="p">,</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span> <span class="s1">'mode'</span> <span class="p">),</span> <span class="nx">settings</span><span class="p">.</span><span class="nx">attributes</span> <span class="p">);</span>
</code></pre>
      </div>
    </li>
    <li>
      <p>Rebuild the plugin</p>

      <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>rm static/repository/build/myviz_pdb.js
<span class="gp">$ </span>webpack
</code></pre>
      </div>
    </li>
    <li>
      <p>Refresh your browser.</p>
    </li>
    <li>Load <em>Charts</em> and test different rendering modes in the <em>Customization</em> tab of your visualization.</li>
  </ol>

</blockquote>

<h2 id="section-3---adding-more-options">Section 3 - Adding more options</h2>

<p>From the <em>PV-Viewer</em> documentation we can see that there are more settings available such as e.g. ‘pointSize’, ‘lineWidth’ and ‘radius’. In this section we are going to further enhance the visualizations user interface to incorporate these input parameters</p>

<blockquote class="hands_on">
  <h3 id="-hands-on-10"><i class="fa fa-pencil" aria-hidden="true"></i> Hands-on</h3>

  <ol>
    <li>Add the following block into the <code class="highlighter-rouge">settings</code> of your <code class="highlighter-rouge">config.js</code> file:
      <div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">pointSize</span><span class="err">:</span> <span class="p">{</span>
    <span class="nl">label</span> <span class="p">:</span> <span class="s1">'Point size'</span><span class="p">,</span>
    <span class="nx">help</span>  <span class="err">:</span> <span class="s1">'Specify the point size.'</span><span class="p">,</span>
    <span class="nx">type</span>  <span class="err">:</span> <span class="s1">'float'</span><span class="p">,</span>
    <span class="nx">min</span>   <span class="err">:</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="nx">max</span>   <span class="err">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="nx">value</span> <span class="err">:</span> <span class="mi">1</span>
<span class="p">},</span>
<span class="nx">lineWidth</span> <span class="err">:</span> <span class="p">{</span>
    <span class="nl">label</span> <span class="p">:</span> <span class="s1">'Line width'</span><span class="p">,</span>
    <span class="nx">help</span>  <span class="err">:</span> <span class="s1">'Specify the line width.'</span><span class="p">,</span>
    <span class="nx">type</span>  <span class="err">:</span> <span class="s1">'float'</span><span class="p">,</span>
    <span class="nx">min</span>   <span class="err">:</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="nx">max</span>   <span class="err">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="nx">value</span> <span class="err">:</span> <span class="mi">4</span>
<span class="p">},</span>
<span class="nx">radius</span> <span class="err">:</span> <span class="p">{</span>
    <span class="nl">label</span> <span class="p">:</span> <span class="s1">'Radius'</span><span class="p">,</span>
    <span class="nx">help</span>  <span class="err">:</span> <span class="s1">'Radius of tube profile. Also influences the profile thickness for helix and strand profiles.'</span><span class="p">,</span>
    <span class="nx">type</span>  <span class="err">:</span> <span class="s1">'float'</span><span class="p">,</span>
    <span class="nx">min</span>   <span class="err">:</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="nx">max</span>   <span class="err">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="nx">value</span> <span class="err">:</span> <span class="mf">0.3</span>
<span class="p">}</span>
</code></pre>
      </div>
    </li>
    <li>
      <p>Rebuild the plugin</p>

      <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>rm static/repository/build/myviz_pdb.js
<span class="gp">$ </span>webpack
</code></pre>
      </div>
    </li>
    <li>
      <p>Refresh your browser.</p>
    </li>
    <li>Load <em>Charts</em> and test new options in the <em>Customization</em> tab of your visualization.</li>
  </ol>

</blockquote>

<h2 class="no_toc" id="conclusion">Conclusion</h2>

<p>First of all, thank you for completing this tutorial. We have learned how to add visualizations to the <em>Charts</em> framework and how to build a custom visualization form.</p>


        
        <blockquote class="key_points">
            <h3><i class="fa fa-key" aria-hidden="true"></i> Key points</h3>

            <ul>
                
                <li>Charts is a pluggable extension system for JS-only visualisations</li>
                
                <li>With only 3 files we can integrate any JS-only visualizations into Galaxy</li>
                
            </ul>
        </blockquote>
        

        

        <h3><i class="fa fa-thumbs-up" aria-hidden="true"></i> Congratulations on successfully completing this tutorial!</h3>

        <hr>

        <blockquote class="overview">
            <h3><i class="fa fa-comments-o" aria-hidden="true"></i> Help us improve this content!</h3>
            Please take a moment to fill in the Galaxy Training Network
            <a href="https://tinyurl.com/GTNfeedback">Feedback Form</a>.
            Your feedback helps us improve this tutorial and will be considered
            in future revisions.
        </blockquote>
    </section>
</div>


<footer>
    <div class="container">
        <p>
            This material is the result of a collaborative work. Thanks to the
            <a href="https://wiki.galaxyproject.org/Teach/GTN">Galaxy Training Network</a>
            and all the <a href="/training-material/hall-of-fame">contributors</a> (Saskia Hiltemann, Youri Hoogstrate, Björn Grüning, Aysam Guerler)!
        </p>
        <p>
            Found a typo? Something is wrong in this tutorial? Edit it on
            <a href="https://github.com/galaxyproject/training-material/tree/master/topics/dev/tutorials/visualization-charts/tutorial.md">GitHub</a>.
        </p>
    </div>
</footer>

    </body>
    <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/popper.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap.min.js?v=3"></script>
    <script type="text/javascript" src="/training-material/assets/js/details-element-polyfill.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="/training-material/assets/js/main.js"></script>
</html>
